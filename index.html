<!DOCTYPE html>
<html>
<head>
<title>Sorting Visualiztion</title>
</head>
<body onload="initialize()">
	<div id="wrapper"> 
	<h1>Sorting Visualizer</h1>

	<div class="tab">
		<button onclick="sort('bubble')"class="tablinks" id="defaultOpen">Bubble Sort</button>
		<button onclick="sort('merge')"class="tablinks">Merge Sort</button>
		<button onclick="sort('selection')"class="tablinks">Selection Sort</button>
		<button onclick="sort('insertion')"class="tablinks">Insertion Sort</button>
		<button onclick="sort('quick')"class="tablinks">Quick Sort</button>
		<button onclick="generateNewArray();"class="tablinks">GENERATE NEW ARRAY</button>

		 <input type="range" min="5" max="500" value="250" class="slider" id="lenRange">

		</div>

		
	</div>

	<div class="box">
		<div class="array"> </div>
 	</div>
 </div>

</body>
<script type="text/javascript">
	function initialize() {
		LENGTH = 250; //length of array.
		MAX_VALUE = 100; //Max value in array.
		UNIT = (500/MAX_VALUE);
		SPEED = 1;
		sorted = false;
		ARR = generateRandomArray(LENGTH, MAX_VALUE);
		SWAPS = [];
		changeSpeed = false;
		displayArray(ARR);
	}

	function generateNewArray() {
		LENGTH = parseInt(document.getElementById("lenRange").value);
		ARR = generateRandomArray(LENGTH, MAX_VALUE);
		clearArr();
		displayArray(ARR);
		sorted = false;
	}

	function sort(type) {
		if (sorted == false) {
		disableButtons();

		switch (type) {
			case 'merge':
				mergeSort(ARR);
				break;
			case 'bubble':
				bubbleSort(ARR);
				break;
			case 'selection':
				selectionSort(ARR);
				break;
			case 'insertion':
				insertionSort(ARR);
				break;
			case 'quick':
				quickSort(ARR);
				break;
			case 'radix':
				console.log('radix');
				break;
		}
	}
	}


	function mergeSort(arr) {
		let k = 0;
		const animations = doMergeSort(arr);
		var elements = document.body.getElementsByClassName('box')[0].getElementsByClassName('array')[0].getElementsByClassName('elm');
    	var interval =setInterval(function () {
    			if(k < animations.length){
       		  		 const [barOneIdx, newHeight] = animations[k];
          			elements[barOneIdx].style.height = `${newHeight}px`;
       				k++;
   				} else {
					enableButtons();
					sorted = true;
   					clearInterval(interval);
   				}
   				
   				},SPEED);


	}
	function doMergeSort(arr) {
		const animations = [];
		if (arr.length <= 1) return arr;
		const auxArray = arr.slice();
		sortHelper(arr, 0, arr.length - 1, auxArray, animations);

		return animations;

	}

	function sortHelper(arr, start, end, auxArray, animations) {
		if (start == end) return;
		const mid = Math.floor((start + end) / 2);
		sortHelper(auxArray, start, mid, arr, animations);
		sortHelper(auxArray, mid + 1, end, arr, animations);
		merge(arr, start, mid, end, auxArray, animations);

	}

	function merge(arr, start, mid, end, auxArray, animations){
		let k = start;
		let i = start;
		let j = mid + 1;

		while (i <= mid && j <=end) {
			if (auxArray[i] <= auxArray[j]) {
				animations.push([k, UNIT *auxArray[i]]);
				arr[k] = auxArray[i];
				k++;
				i++;
			} else {

				animations.push([k,UNIT * auxArray[j]]);
				arr[k] = auxArray[j];
				k++;
				j++;
			}
		}

		while (i <= mid) {
			animations.push([k, UNIT *auxArray[i]]);
			arr[k] = auxArray[i];
			k ++;
			i ++;
		}

		while (j <= end) {
			animations.push([k, UNIT *auxArray[j]]);
			arr[k] = auxArray[j];
			k ++;
			j++;
		}
		
	}

//QUiCK SORt
	function quickSort(arr) {
		clearArr();
		displayArray(ARR);
		SWAPS = [];
		quick(arr, 0 , arr.length - 1); 
		displaySwaps(SWAPS);
    
	}

	function quick(arr, start, end) {
		if (start >= end) {
			return;
		}

		let index = partition(arr, start,end);
		quick(arr, start, index - 1);
		quick(arr, index + 1, end);

	}

	function partition(arr, start,end) {
		let pivotValue = arr[end];
		let pivotIndex = start;

		for (let i = start; i < end; i ++) {
			if (arr[i] < pivotValue) {
				swap(arr,i, pivotIndex);
				SWAPS.push([pivotIndex, i]);
				pivotIndex ++;
			}
		}

		swap(arr, pivotIndex, end);
		SWAPS.push([pivotIndex,end]);
		return pivotIndex;
		
	}

	function swap(arr, idx1, idx2) {
		var temp = arr[idx1];
		arr[idx1] = arr[idx2];
		arr[idx2] = temp;
	}



	function clearArr() {
		const myNode = document.getElementsByClassName('box')[0].getElementsByClassName('array')[0];
		while (myNode.firstChild) {
			myNode.removeChild(myNode.firstChild);
		}

	}

	function insertionSort(arr) {
		clearArr();
		displayArray(ARR);
			insertions = [];
			for (var i = 1; i < LENGTH; i++) {
				var key = arr[i];
				var j = i - 1;
				while (j >= 0 && arr[j] > key) {
					arr[j + 1] = arr[j];
					j --;
				}
				var insert = j + 1;
				arr[insert] = key;
				insertions.push([i, insert]);
			}
		displayInsertion(insertions);

	}

	function displayInsertion(insertions) {
		let k = 0;
    	var interval =setInterval(function () {
    			if(k < insertions.length){
       		  		insert(insertions[k][0],insertions[k][1]);
       					k++;
   				} else {
					enableButtons();
					sorted = true;
   					clearInterval(interval);
   				}
   				},SPEED);
		}

	function disableButtons() {
		var buttons = document.getElementsByClassName("tablinks");
		for (var i = 0;  i < buttons.length; i++) {
			buttons[i].disabled = true;
		}
	}

	function enableButtons() {
		var buttons = document.getElementsByClassName("tablinks");
		for (var i = 0;  i < buttons.length; i++) {
			buttons[i].disabled = false;
		}
	}	
	
	//From https://stackoverflow.com/questions/9732624/how-to-swap-dom-child-nodes-in-javascript
	function swapNodes(idx1, idx2) {
	    var elements = document.body.getElementsByClassName('box')[0].getElementsByClassName('array')[0].getElementsByClassName('elm');
	    var node1= elements[idx1];
	    var node2 = elements[idx2];
	
		const parent = node2.parentNode;
		const afterNode2 = node2.nextElementSibling;
		node1.replaceWith(node2);
		parent.insertBefore(node1, afterNode2);

	}

	function insert(keyPos, insertPos) {
		var elements = document.body.getElementsByClassName('box')[0].getElementsByClassName('array')[0].getElementsByClassName('elm');
		var parent = elements[keyPos].parentNode;
		var elm = elements[keyPos];
		parent.insertBefore(elm,elements[insertPos]);
	}


	function bubbleSort(arr) {
		SWAPS = [];
		clearArr();
		displayArray(ARR);
		swaps = [];
				for (let i = 0; i < LENGTH-1; i++) {
					for(let j = 0; j < LENGTH-i-1; j++) {
						if(arr[j] > arr[j+1]) {
							swap(arr, j, j + 1);
							SWAPS.push([j, j+1]);
						}
					}
				}
				displaySwaps(SWAPS)

	}

	function selectionSort(arr){
		SWAPS = [];
		clearArr();
		displayArray(ARR);
			swaps = [];
				for (var i = 0; i < LENGTH-1; i++) {
					let min_idx = i;
					for (var j = i + 1; j < LENGTH; j++) {
						if (arr[j] < arr[min_idx]) {
							min_idx = j;
						}
					}
					temp = arr[min_idx];
					arr[min_idx] = arr[i];
					arr[i] = temp;
					SWAPS.push([i,min_idx]);
				}
				displaySwaps(SWAPS);

	}
	function displaySwaps(swaps) {
			let k = 0;
    			var interval = setInterval(function () {
    				if(k < swaps.length){
        				swapNodes(swaps[k][0],swaps[k][1]);
        					k++;
    				} else {
    					enableButtons();
    					sorted = true;
    					clearInterval(interval);
    				}
    			},SPEED);
		}

 	function generateRandomArray(length, max) {
		return Array(length).fill().map(() => Math.round(Math.random() * max));
	}

	function displayArray(arr) {
		width = 1000/LENGTH;
		for (i = 0; i < LENGTH; i ++) {
			var elm = document.createElement("div");
			elm.className = 'elm';
			elm.style.backgroundColor = 'black';
			elm.style.width = "" + width + "px";
			elm.style.height = "" + (500/MAX_VALUE)*arr[i] + "px";
			document.body.getElementsByClassName("array")[0].appendChild(elm);

		}
	}
	

	document.addEventListener("keydown", keyPressed);

	function keyPressed() {
		 if (event.keyCode === 83) {
		 	changeSpeed = true;
            speedArray = [1,25,1000];
            var speedIdx = speedArray.indexOf(SPEED);
            SPEED = speedArray[(speedIdx + 1) % 3];
        }

	}



</script>


<style>
	* {
		margin:0;
		padding: 0;
	}
	#wrapper {
		margin-left: auto;
		margin-right: auto;
		width:1020px;
	}
	.elm {
		position: relative;
		float:left;
	}
	.array {
	  	/*border: 1px solid black; */
		align-self: center;
		width:1000px; 
		height:20px;
	}
	.box {
		display: flex;
		flex-direction: column;
		height: 500px;
		border: 1px solid #ccc;

	}
	h1 {
		position: relative;
	}
	.tab {
		position:relative;
		overflow: hidden;
		border: 1px solid #ccc;
		background-color: #f1f1f1;
	}

	.tab button {
		background-color: inherit;
		float:left;
		border: none;
		outline: none;
		cursor: pointer;
		padding: 14px 16px;
		transition: 0.3s;
		font-size:17px;
	}

	.tab button:hover {
		background-color: #ddd;
	}

	.tab button.active {
		background-color: #ccc;
	}

	.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 25px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  background: black;
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 25px;
  height: 25px;
  background: #4CAF50;
  cursor: pointer;
}


</style>
</html>